<div class="container">
  <h1 class="page-title">タスク一覧</h1>

  <%= form_with scope: :search, method: :get, url: search_tasks_path, local: true do |f| %>
    <table>
      <tr>
        <th><%= f.label :name_search, '名称検索' %></th>
        <% if @search_params.present? %>
        <%# タスク検索後、入力値を初期値とする。 以下同じ %>
          <td><%= f.text_field :name, value: @search_params[:name] %></td>
        <% else %>
          <td><%= f.text_field :name %></td>
        <% end %>

        <th><%= f.label :status_search, 'ステータス検索' %></th>
        <% if @search_params.present? %>
          <td><%= f.select :status, Task.statuses_i18n.invert,
                  include_blank: true, selected: @search_params[:status] %></td>
        <% else %>
          <td><%= f.select :status, Task.statuses_i18n.invert,
                  include_blank: true, selected: '' %></td>
        <% end %>

        <th><%= f.label :expired_at, '終了期限でソート' %></th>
        <% if @search_params.present? %>
          <% expired_flag = true if @search_params[:expired_at] == 'true' %>
          <td><%= f.check_box :expired_at, { checked: expired_flag }, 'true', 'false' %></td>
        <% else %>
          <td><%= f.check_box :expired_at, {}, 'true', 'false' %></td>
        <% end %>

        <th><%= f.label :priority, '優先順位でソート' %></th>
        <% if @search_params.present? %>
          <% priority_flag = true if @search_params[:priority] == 'true' %>
          <td><%= f.check_box :priority, { checked: priority_flag }, 'true', 'false' %></td>
        <% else %>
          <td><%= f.check_box :priority, {}, 'true', 'false' %></td>
        <% end %>

        <td><%= f.submit '実行する', class: 'btn' %></td>
      </tr>
    </table>
  <% end %>

  <%= link_to '新規作成', new_task_path, class: 'btn' %>
  <%= link_to '終了期限でソート', tasks_path(sort_expired: true), class: 'btn' %>
  <%= link_to '優先順位でソート', tasks_path(sort_priority: true), class: 'btn' %>

  <div class="task-list">
    <table>
      <thead>
        <tr>
          <th>優先順位</th>
          <th>ステータス</th>
          <th>名称</th>
          <th>登録日時</th>
          <th>終了期限</th>
          <th colspan="3"></th>
        </tr>
      </thead>

      <tbody>
        <% @tasks.each do |task| %>
          <tr>
            <td><%= task.priority_i18n %></td>
            <td><%= task.status_i18n %></td>
            <td class="task_row"><%= task.name %></td>
            <td><%= task.created_at.strftime('%Y年%m月%d日 %H:%M') %></td>
            <td><%= task.expired_at.strftime('%Y年%m月%d日 %H:%M') %></td>
            <td><%= link_to '詳細', task %></td>
            <td><%= link_to '編集', edit_task_path(task) %></td>
            <td><%= link_to '削除', task, method: :delete, data: { confirm: '削除してよろしいですか？' } %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div><!-- /.task-list -->
</div><!-- /.container -->

<footer class="page-footer">
  <%= link_to 'DIVE INTO CODE', 'https://diveintocode.jp/', class: 'footer-link' %>
</footer>